<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Soundboard 3000 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a1a2e;
            color: #ffffff;
            overflow-x: hidden;
        }

        .retro-font {
            font-family: 'Press Start 2P', cursive;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a2e; }
        ::-webkit-scrollbar-thumb { background: #e94560; border-radius: 4px; }

        .sound-btn {
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .sound-btn:active, .sound-btn.playing {
            transform: scale(0.95);
            box-shadow: 0 0 15px currentColor;
            border-color: transparent;
        }

        .glow-text { text-shadow: 0 0 10px rgba(233, 69, 96, 0.7); }
        
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px; width: 18px;
            border-radius: 50%; background: #e94560;
            cursor: pointer; margin-top: -7px; 
            box-shadow: 0 0 8px #e94560;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            cursor: pointer; background: #16213e; border-radius: 2px;
        }

        .status-active {
            background-color: #e94560 !important;
            box-shadow: 0 0 15px #e94560;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-appearance: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .app-card {
            background: #16213e;
            border: 1px solid #2d3748;
            transition: all 0.2s;
        }
        .app-card.detected {
            border-color: #48bb78;
            background: #1c2d24;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="p-6 text-center border-b border-gray-800 bg-gray-900 shadow-lg sticky top-0 z-50">
        <h1 class="retro-font text-2xl md:text-4xl text-[#e94560] glow-text mb-2">
            <i class="fas fa-music mr-2"></i>MEME BOARD
        </h1>
        <div class="flex justify-center gap-4">
            <button onclick="toggleModal('app-hub')" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest flex items-center gap-2 transition-all">
                <i class="fas fa-plug"></i> App Connection Hub
            </button>
            <label class="bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest flex items-center gap-2 transition-all cursor-pointer">
                <i class="fas fa-plus"></i> Add Custom Sound
                <input type="file" id="sound-upload" accept="audio/*" class="hidden">
            </label>
        </div>
    </header>

    <!-- Controls Panel -->
    <div class="bg-gray-800 border-b border-gray-700 p-4 shadow-md z-40">
        <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6 items-center">
            
            <!-- Left: Volume & Stop -->
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-3 flex-grow">
                    <i class="fas fa-volume-down text-gray-400"></i>
                    <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.5" class="w-full">
                    <i class="fas fa-volume-up text-[#e94560]"></i>
                </div>
                <button id="stop-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg transform transition active:scale-95 flex items-center gap-2 text-sm whitespace-nowrap">
                    <i class="fas fa-stop"></i> STOP ALL
                </button>
            </div>

            <!-- Middle: Device Selection -->
            <div class="flex flex-col sm:flex-row gap-3">
                <div class="flex-grow">
                    <label class="text-[10px] text-gray-500 font-bold uppercase block mb-1">Mic Input (Relay)</label>
                    <select id="mic-select" class="w-full bg-gray-900 border border-gray-700 text-gray-300 text-xs rounded-md p-2 focus:border-[#e94560] outline-none transition-colors">
                        <option value="">Default Microphone</option>
                    </select>
                </div>
                <div class="flex-grow">
                    <label class="text-[10px] text-gray-500 font-bold uppercase block mb-1">Target Output (Virtual Cable)</label>
                    <select id="output-select" class="w-full bg-gray-900 border border-gray-700 text-gray-300 text-xs rounded-md p-2 focus:border-[#e94560] outline-none transition-colors">
                        <option value="">Default Output</option>
                    </select>
                </div>
            </div>

            <!-- Right: Feature Toggles -->
            <div class="flex gap-2">
                <button id="mic-btn" class="flex-grow bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg transform transition active:scale-95 flex flex-col items-center justify-center text-[10px]">
                    <i class="fas fa-microphone mb-1"></i> <span id="mic-text">RELAY MIC</span>
                </button>
                <button id="monitor-btn" class="flex-grow bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg transform transition active:scale-95 flex flex-col items-center justify-center text-[10px]">
                    <i class="fas fa-headphones mb-1"></i> <span id="monitor-text">MONITOR OFF</span>
                </button>
                <button id="refresh-devices" class="bg-gray-700 hover:bg-gray-600 text-white p-2 rounded-lg">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Sound Grid -->
    <main class="flex-grow p-4 md:p-8">
        <div id="sound-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 max-w-6xl mx-auto"></div>
    </main>

    <!-- App Hub Modal -->
    <div id="app-hub" class="modal">
        <div class="bg-gray-900 p-8 rounded-2xl border border-gray-700 max-w-3xl w-full mx-4 shadow-2xl overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center mb-6 border-b border-gray-800 pb-4">
                <div>
                    <h2 class="retro-font text-[#e94560] text-xl">App Connection Hub</h2>
                    <p class="text-xs text-gray-500 mt-1">Status: Scanning for audio pathways...</p>
                </div>
                <button onclick="toggleModal('app-hub')" class="text-gray-500 hover:text-white transition-colors"><i class="fas fa-times text-2xl"></i></button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                <!-- Discord -->
                <div class="app-card p-4 rounded-xl flex items-center justify-between" id="app-discord">
                    <div class="flex items-center gap-3">
                        <i class="fab fa-discord text-3xl text-[#5865F2]"></i>
                        <div>
                            <p class="font-bold text-sm">Discord</p>
                            <p class="text-[10px] text-gray-400" id="discord-status">Checking input usage...</p>
                        </div>
                    </div>
                    <div class="h-3 w-3 rounded-full bg-gray-600" id="discord-indicator"></div>
                </div>
                <!-- Roblox -->
                <div class="app-card p-4 rounded-xl flex items-center justify-between" id="app-roblox">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-cube text-3xl text-red-500"></i>
                        <div>
                            <p class="font-bold text-sm">Roblox</p>
                            <p class="text-[10px] text-gray-400" id="roblox-status">Checking voice chat...</p>
                        </div>
                    </div>
                    <div class="h-3 w-3 rounded-full bg-gray-600" id="roblox-indicator"></div>
                </div>
            </div>

            <div class="bg-blue-900/20 border border-blue-800 p-4 rounded-xl">
                <h4 class="text-blue-400 font-bold text-sm mb-2"><i class="fas fa-info-circle mr-2"></i>Virtual Link Guide</h4>
                <p class="text-xs text-gray-400 leading-relaxed mb-3">To route sounds to other apps: Set your <b>Output</b> to a Virtual Cable, then go to the Target App (Discord) and set its <b>Microphone</b> to that same Virtual Cable.</p>
                <div class="space-y-2">
                    <button onclick="autoMatchDevices()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded font-bold text-xs uppercase tracking-tighter transition-all">
                        Auto-Sync Virtual Cable
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-5 right-5 bg-red-500 text-white px-4 py-2 rounded shadow-lg transform translate-y-20 transition-transform duration-300 z-50"></div>

    <script>
        const initialSounds = [
            { id: 'vine-boom', name: 'Vine Boom', emoji: 'ðŸ’¥', url: 'https://www.myinstants.com/media/sounds/vine-boom.mp3', color: 'border-yellow-500 text-yellow-500 hover:bg-yellow-500/10' },
            { id: 'airhorn', name: 'Airhorn', emoji: 'ðŸ“¢', url: 'https://www.myinstants.com/media/sounds/air-horn-club-sample_1.mp3', color: 'border-red-500 text-red-500 hover:bg-red-500/10' },
            { id: 'bruh', name: 'Bruh', emoji: 'ðŸ—¿', url: 'https://www.myinstants.com/media/sounds/movie_1.mp3', color: 'border-gray-400 text-gray-400 hover:bg-gray-400/10' },
            { id: 'discord', name: 'Discord', emoji: 'ðŸ””', url: 'https://www.myinstants.com/media/sounds/discord-notification.mp3', color: 'border-blue-400 text-blue-400 hover:bg-blue-400/10' },
            { id: 'fbi', name: 'FBI Open Up', emoji: 'ðŸ‘®', url: 'https://www.myinstants.com/media/sounds/fbi-open-up.mp3', color: 'border-blue-600 text-blue-600 hover:bg-blue-600/10' },
            { id: 'bonk', name: 'Bonk', emoji: 'ðŸ”¨', url: 'https://www.myinstants.com/media/sounds/bonk_sound_effect.mp3', color: 'border-orange-500 text-orange-500 hover:bg-orange-500/10' },
            { id: 'roblox-oof', name: 'Oof', emoji: 'ðŸ’€', url: 'https://www.myinstants.com/media/sounds/roblox-death-sound_1.mp3', color: 'border-red-600 text-red-600 hover:bg-red-600/10' },
            { id: 'emotional-damage', name: 'Emotional Dmg', emoji: 'ðŸ’”', url: 'https://www.myinstants.com/media/sounds/emotional-damage-meme.mp3', color: 'border-blue-500 text-blue-500 hover:bg-blue-500/10' },
            { id: 'badum-tss', name: 'Ba Dum Tss', emoji: 'ðŸ¥', url: 'https://www.myinstants.com/media/sounds/ba-dum-tss-sound-effect.mp3', color: 'border-orange-400 text-orange-400 hover:bg-orange-400/10' }
        ];

        let sounds = [...initialSounds];
        const grid = document.getElementById('sound-grid');
        const volumeSlider = document.getElementById('volume-slider');
        const stopBtn = document.getElementById('stop-btn');
        const micBtn = document.getElementById('mic-btn');
        const monitorBtn = document.getElementById('monitor-btn');
        const micSelect = document.getElementById('mic-select');
        const outputSelect = document.getElementById('output-select');
        const refreshBtn = document.getElementById('refresh-devices');
        const uploadInput = document.getElementById('sound-upload');

        let activeAudios = [];
        let globalVolume = 0.5;
        let isMicEnabled = false;
        let isMonitoring = false;
        let audioCtx, micStream, micNode;

        // Initialize App
        function init() {
            renderGrid();
            updateDeviceLists();
            
            // Check for setSinkId Support
            if (!HTMLMediaElement.prototype.setSinkId) {
                showToast("Note: This browser cannot route audio to specific devices. Try Chrome/Edge.");
            }
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
            if (m.style.display === 'flex') scanForApps();
        }

        async function updateDeviceLists() {
            try {
                // Requesting permission early helps populate labels
                if (!micStream) await navigator.mediaDevices.getUserMedia({ audio: true }).catch(() => null);
                
                const devices = await navigator.mediaDevices.enumerateDevices();
                micSelect.innerHTML = '<option value="">Default Microphone</option>';
                outputSelect.innerHTML = '<option value="">Default Output</option>';
                
                devices.forEach(device => {
                    if (device.kind === 'audioinput') {
                        const opt = document.createElement('option');
                        opt.value = device.deviceId;
                        opt.text = device.label || `Microphone ${micSelect.length}`;
                        micSelect.appendChild(opt);
                    } else if (device.kind === 'audiooutput') {
                        const opt = document.createElement('option');
                        opt.value = device.deviceId;
                        opt.text = device.label || `Output ${outputSelect.length}`;
                        outputSelect.appendChild(opt);
                    }
                });
            } catch (err) {
                showToast("Device scan failed.");
            }
        }

        async function scanForApps() {
            const devices = await navigator.mediaDevices.enumerateDevices();
            const labels = devices.map(d => d.label.toLowerCase());

            const check = (keywords, appPrefix) => {
                const found = keywords.some(k => labels.some(l => l.includes(k)));
                const card = document.getElementById(`app-${appPrefix}`);
                const status = document.getElementById(`${appPrefix}-status`);
                const indicator = document.getElementById(`${appPrefix}-indicator`);

                if (found) {
                    card.classList.add('detected');
                    status.textContent = "Potential Link Found";
                    indicator.classList.remove('bg-gray-600');
                    indicator.classList.add('bg-emerald-500');
                } else {
                    card.classList.remove('detected');
                    status.textContent = "No driver found";
                    indicator.classList.add('bg-gray-600');
                    indicator.classList.remove('bg-emerald-500');
                }
            };

            check(['discord'], 'discord');
            check(['roblox'], 'roblox');
        }

        async function autoMatchDevices() {
            const devices = await navigator.mediaDevices.enumerateDevices();
            const target = devices.find(d => 
                d.kind === 'audiooutput' && 
                (d.label.toLowerCase().includes('cable') || d.label.toLowerCase().includes('virtual'))
            );

            if (target) {
                outputSelect.value = target.deviceId;
                showToast(`Auto-linked to: ${target.label}`);
            } else {
                showToast("No Virtual Cables detected.");
            }
        }

        async function toggleMic() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            if (!isMicEnabled) {
                try {
                    const constraints = { audio: micSelect.value ? { deviceId: { exact: micSelect.value } } : true };
                    micStream = await navigator.mediaDevices.getUserMedia(constraints);
                    micNode = audioCtx.createMediaStreamSource(micStream);
                    
                    // We connect it to the destination so it routes to whatever 'Default' system output is
                    // or we'd need to use a complex audio routing if we want the mic to follow the Output Select.
                    micNode.connect(audioCtx.destination);
                    
                    isMicEnabled = true;
                    micBtn.classList.add('status-active');
                    document.getElementById('mic-text').textContent = "RELAY ON";
                } catch (err) {
                    showToast("Could not start Mic Relay.");
                }
            } else {
                if (micStream) micStream.getTracks().forEach(t => t.stop());
                if (micNode) micNode.disconnect();
                isMicEnabled = false;
                micBtn.classList.remove('status-active');
                document.getElementById('mic-text').textContent = "RELAY MIC";
            }
        }

        async function playSound(soundData, btn) {
            btn.classList.add('playing');
            
            // Create audio element
            const audio = new Audio(soundData.url);
            audio.volume = globalVolume;

            // Route to Virtual Cable if selected
            if (outputSelect.value && audio.setSinkId) {
                try {
                    await audio.setSinkId(outputSelect.value);
                } catch (e) {
                    console.error("SinkId routing failed", e);
                }
            }

            activeAudios.push(audio);
            audio.play();

            // Monitoring (Play through speakers too so you hear what you're playing)
            if (isMonitoring && outputSelect.value !== "") {
                const mon = new Audio(soundData.url);
                mon.volume = globalVolume;
                mon.play();
            }

            audio.onended = () => {
                btn.classList.remove('playing');
                activeAudios = activeAudios.filter(a => a !== audio);
            };
        }

        function renderGrid() {
            grid.innerHTML = '';
            sounds.forEach((s, index) => {
                const btn = document.createElement('button');
                btn.className = `sound-btn h-32 w-full rounded-xl border-2 flex flex-col items-center justify-center gap-2 bg-gray-800 transition-colors ${s.color || 'border-gray-500 text-white'}`;
                
                // Show index if < 10 for hotkeys
                const hotkeyLabel = index < 9 ? `<span class="absolute top-2 left-2 text-[9px] opacity-40">Key: ${index + 1}</span>` : '';
                
                btn.innerHTML = `
                    ${hotkeyLabel}
                    <span class="text-4xl">${s.emoji}</span>
                    <span class="font-bold text-[11px] uppercase text-center px-2">${s.name}</span>
                `;
                
                btn.onclick = () => playSound(s, btn);
                // Right-click to stop just this sound
                btn.oncontextmenu = (e) => {
                    e.preventDefault();
                    stopSpecificSound(s.url);
                };
                
                grid.appendChild(btn);
            });
        }

        function stopSpecificSound(url) {
            activeAudios.forEach(a => {
                if (a.src === url) {
                    a.pause();
                    a.currentTime = 0;
                }
            });
            activeAudios = activeAudios.filter(a => a.src !== url);
        }

        // Custom Sound Upload
        uploadInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                const newSound = {
                    id: `custom-${Date.now()}`,
                    name: file.name.split('.')[0].substring(0, 15),
                    emoji: 'ðŸ“',
                    url: url,
                    color: 'border-emerald-500 text-emerald-500 hover:bg-emerald-500/10'
                };
                sounds.push(newSound);
                renderGrid();
                showToast("Sound added!");
            }
        });

        // Global Stop
        stopBtn.onclick = () => {
            activeAudios.forEach(a => { a.pause(); a.currentTime = 0; });
            activeAudios = [];
            document.querySelectorAll('.sound-btn').forEach(b => b.classList.remove('playing'));
        };

        // Keyboard Hotkeys
        window.addEventListener('keydown', (e) => {
            const key = parseInt(e.key);
            if (key >= 1 && key <= 9 && key <= sounds.length) {
                const btn = grid.children[key - 1];
                playSound(sounds[key - 1], btn);
            }
            if (e.key === 'Escape' || e.key === 's') {
                stopBtn.click();
            }
        });

        // Volume Control
        volumeSlider.oninput = (e) => {
            globalVolume = e.target.value;
            activeAudios.forEach(a => a.volume = globalVolume);
        };

        // Monitoring Toggle
        monitorBtn.onclick = () => {
            isMonitoring = !isMonitoring;
            monitorBtn.classList.toggle('status-active', isMonitoring);
            document.getElementById('monitor-text').textContent = isMonitoring ? "MONITOR ON" : "MONITOR OFF";
        };

        micBtn.onclick = toggleMic;
        refreshBtn.onclick = updateDeviceLists;

        function showToast(m) {
            const t = document.getElementById('toast');
            t.textContent = m;
            t.classList.remove('translate-y-20');
            setTimeout(() => t.classList.add('translate-y-20'), 3000);
        }

        window.onload = init;
    </script>
</body>
</html>
